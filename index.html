<!doctype html>
<html lang="lv">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>LegitSpace â€” 6.6 Â· Mars Edition</title>
<meta name="description" content="LegitSpace â€” Real by Default. Real Flow: honest, human, real-time.">
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'%3E%3Ccircle cx='64' cy='64' r='64' fill='%23111'/%3E%3Ctext x='50%' y='56%' dominant-baseline='middle' text-anchor='middle' font-size='62' fill='%23fff' font-family='Arial'%3ELS%3C/text%3E%3C/svg%3E">
<style>
  :root{
    --ink:#1b140d;
    --muted:#6b5b4d;
    --card:rgba(255,255,255,.92);
    --ring:rgba(180,83,9,.25);
    --shadow:0 12px 40px rgba(0,0,0,.14)
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{
    font-family:Inter,system-ui,Arial,sans-serif;
    background:#000;
    color:var(--ink);
    height:100%;
  }
  body{
    background-image:
      linear-gradient(180deg,#3d2313 0%,#b07b53 100%),
      radial-gradient(ellipse at 40% 20%,rgba(255,255,255,.15) 0%,transparent 70%),
      radial-gradient(ellipse at 80% 90%,rgba(255,200,150,.15) 0%,transparent 70%);
    background-attachment:fixed;
    background-size:cover;
  }
  .wrap{max-width:1100px;margin:0 auto;padding:0 18px;position:relative;z-index:1}
  .topbar{
    position:sticky;top:0;z-index:10;
    background:rgba(0,0,0,.6);
    backdrop-filter:blur(8px);
    border-bottom:1px solid rgba(255,255,255,.1);
  }
  .nav{
    display:flex;align-items:center;justify-content:space-between;
    padding:10px 0;
  }
  .brand{display:flex;align-items:center;gap:10px;color:#fff}
  .brand .tag{font-size:12px;background:#111;color:#fff;border-radius:999px;padding:2px 8px}
  .menu{display:flex;gap:8px;flex-wrap:wrap}
  .menu button{
    color:#fff;background:transparent;
    border:1px solid transparent;
    border-radius:999px;padding:6px 10px;cursor:pointer;
  }
  .menu button:hover{border-color:#444}
  .menu button.active{border-color:#fff}
  .controls{display:flex;align-items:center;gap:8px}
  .chip{
    border:1px solid #ddd;background:#fff;
    border-radius:999px;padding:6px 10px;cursor:pointer
  }
  .btn{
    background:#111;color:#fff;
    border:1px solid #111;
    border-radius:12px;padding:8px 12px;cursor:pointer
  }
  .btn.ghost{background:#fff;color:#111;border:1px solid #ddd}
  .card{
    background:var(--card);
    backdrop-filter:blur(8px);
    border:1px solid rgba(255,255,255,.6);
    box-shadow:var(--shadow);
    border-radius:16px;
    padding:18px;margin:16px 0
  }
  h1{margin:.2rem 0 .3rem}
  .lead{color:var(--muted);margin:0 0 10px}
  .section-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  textarea{
    grid-column:1/-1;padding:12px;
    border:1px solid #d8cbbb;border-radius:12px;
    resize:vertical;background:rgba(255,255,255,.95)
  }
  .count{color:#7c6a58;font-size:12px;margin-top:6px}
  .alert{
    background:#fff3cd;border:1px solid #ffe69c;
    color:#7a5d00;border-radius:12px;padding:8px 12px;margin-bottom:10px
  }
  footer{
    color:#ddd;display:flex;justify-content:center;gap:14px;
    flex-wrap:wrap;padding:36px 0
  }
  .footer-link{color:#fff;text-decoration:underline;cursor:pointer}
  .snack{
    position:fixed;left:50%;bottom:24px;
    transform:translateX(-50%);
    background:#111;color:#fff;
    padding:10px 14px;border-radius:10px;
    box-shadow:0 6px 24px rgba(0,0,0,.25);
    opacity:0;transition:opacity .25s;z-index:40
  }
  .snack.show{opacity:1}
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<div class="topbar">
  <div class="wrap nav">
    <div class="brand"><strong>LegitSpace</strong><span class="tag">6.6</span></div>
    <nav class="menu" role="tablist" aria-label="Primary">
      <button type="button" data-tab="realflow" class="active">Real Flow</button>
      <button type="button" data-tab="news">ZiÅ†as</button>
      <button type="button" data-tab="chat">ÄŒats</button>
    </nav>
    <div class="controls">
      <div class="langctl">
        <button id="lang-lv" type="button" class="chip" aria-pressed="true">LV</button>
        <button id="lang-en" type="button" class="chip" aria-pressed="false">EN</button>
      </div>
      <button id="authBtn" type="button" class="btn ghost">Sign in</button>
    </div>
  </div>
</div>

<main class="wrap">
<section id="realflow" class="card">
  <h1 data-i18n="hero_title">Real Flow â€” share whatâ€™s real.</h1>
  <p class="lead" data-i18n="hero_lead">One short, honest thought from your day. No bots. Just people.</p>

  <div class="composer">
    <div id="syntheticAlert" class="alert" hidden data-i18n="synthetic_alert">âš ï¸ This sounds a bit synthetic. Try saying it in your own words.</div>
    <div class="compose">
      <textarea id="rfText" rows="3" maxlength="260" data-i18n-ph="rf_placeholder" placeholder="Whatâ€™s real right now?"></textarea>
      <input type="file" id="rfMedia" accept="image/*,video/*">
      <button id="rfPost" class="btn" data-i18n="say_btn" type="button">Say it</button>
      <div class="count"><span id="chars">0</span>/260</div>
    </div>
  </div>

  <div id="rfFeed" style="margin-top:20px;display:flex;flex-direction:column;gap:12px;"></div>
</section>

<!-- Latvijas ziÅ†as (RSS) sadaÄ¼a -->
<section id="news" class="card" style="display:none;">
  <div class="section-title">
    <h1>Latvijas ziÅ†as (LSM)</h1>
    <small>4 jaunÄkie raksti</small>
  </div>
  <div id="rssFeed" style="display:grid;gap:16px;"></div>
</section>

<!-- ÄŒats sadaÄ¼a -->
<section id="chat" class="card" style="display:none;">
  <div class="section-title">
    <h1>ÄŒats</h1>
    <select id="roomSelect" class="chip">
      <option value="riga">â˜• RÄ«ga</option>
      <option value="europe">ğŸŒ Europe</option>
      <option value="tech">ğŸ”§ Tech</option>
    </select>
  </div>

  <div id="chatBox" style="height:320px;overflow-y:auto;border:1px solid #ddd;border-radius:10px;padding:10px;background:rgba(255,255,255,.8);"></div>

  <div style="display:flex;gap:8px;margin-top:10px;">
    <input id="chatInput" type="text" placeholder="Raksti ziÅ†u..." style="flex:1;padding:8px;border:1px solid #ccc;border-radius:10px;">
    <button id="sendMsg" class="btn">SÅ«tÄ«t</button>
  </div>
</section>

<!-- Snack paziÅ†ojums -->
<div id="snack" class="snack"></div>

<!-- Galvenais JS -->
<script>
const SUPABASE_URL = "https://rcgdatywaumtbcmpomti.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJjZ2RhdHl3YXVtdGJjbXBvbXRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2NjYzODEsImV4cCI6MjA3NjI0MjM4MX0.L3VlIoytD6Ul7Qnrgm3ZyeFhL-qFk7Ujze4GzZ3qZlI";
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// SadaÄ¼u pÄrslÄ“gÅ¡ana
const tabs = document.querySelectorAll('.menu button');
tabs.forEach(btn=>{
  btn.addEventListener('click',()=>{
    tabs.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('main section').forEach(sec=>sec.style.display='none');
    document.getElementById(btn.dataset.tab).style.display='block';
  });
});

// Snack helper
function showSnack(msg){
  const s=document.getElementById('snack');
  s.textContent=msg;
  s.classList.add('show');
  setTimeout(()=>s.classList.remove('show'),2500);
}

// RSS ielÄde no LSM
async function loadRSS(){
  try{
    // Izmanto publisku proxy, lai apietu CORS
const rssUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent('https://www.lsm.lv/rss/');
const res = await fetch(rssUrl);
const data = await res.json();
const text = data.contents;
;
    items.forEach(item=>{
      const title=item.querySelector('title').textContent;
const desc=item.querySelector('description')?.textContent?.slice(0,200)||'';
const link=item.querySelector('link').textContent;
const pub=item.querySelector('pubDate').textContent;
const div=document.createElement('div');
div.innerHTML=`
  <p style="margin-bottom:6px;"><strong>${post.text}</strong></p>
  ${post.media_url ? post.media_url.endsWith('.mp4')
    ? '<video controls style="max-width:100%;border-radius:10px"><source src="'+post.media_url+'"></video>'
    : '<img src="'+post.media_url+'" style="max-width:100%;border-radius:10px">'
    : ''}
  <div style="margin-top:6px;font-size:13px;color:#666;">â¤ï¸ â˜• ğŸŒ¿ ğŸ™Œ</div>`;

feed.appendChild(div);
});
}catch(e){console.log('RSS kÄ¼Å«da',e)}
}
loadRSS();

// ÄŒats
const chatBox=document.getElementById('chatBox');
const chatInput=document.getElementById('chatInput');
const sendBtn=document.getElementById('sendMsg');
const roomSelect=document.getElementById('roomSelect');
let currentRoom='riga';

async function loadChat(room){
  chatBox.innerHTML='';
  const {data}=await supabase.from('messages').select('*').eq('room_id',room).order('created_at',{ascending:true});
  data?.forEach(m=>renderMsg(m));
}
function renderMsg(m){
  const div=document.createElement('div');
  div.textContent=`${m.username || 'Anon'}: ${m.text}`;
  chatBox.appendChild(div);
  chatBox.scrollTop=chatBox.scrollHeight;
}

roomSelect.addEventListener('change',async()=>{
  currentRoom=roomSelect.value;
  await loadChat(currentRoom);
});

sendBtn.addEventListener('click',async()=>{
  const txt=chatInput.value.trim();
  if(!txt)return;
  await supabase.from('messages').insert([{room_id:currentRoom,text:txt}]);
  chatInput.value='';
});

// Realtime updates
supabase.channel('realtime:messages')
  .on('postgres_changes',{event:'INSERT',schema:'public',table:'messages'},payload=>{
    if(payload.new.room_id===currentRoom)renderMsg(payload.new);
  }).subscribe();
  // Auth (magic link)
const authBtn=document.getElementById('authBtn');
authBtn.addEventListener('click',async()=>{
  const email=prompt('Enter your email to sign in:');
  if(!email)return;
  const {error}=await supabase.auth.signInWithOtp({email});
  if(error)showSnack('Error sending magic link');
  else showSnack('Check your email for login link');
});

supabase.auth.onAuthStateChange(async(event,session)=>{
  if(session){
    authBtn.textContent=session.user.email;
    showSnack('Signed in as '+session.user.email);
  }else{
    authBtn.textContent='Sign in';
  }
});

// Real Flow
const rfText=document.getElementById('rfText');
const rfPost=document.getElementById('rfPost');
const rfFeed=document.getElementById('rfFeed');
const rfMedia=document.getElementById('rfMedia');
const syntheticAlert=document.getElementById('syntheticAlert');

rfText.addEventListener('input',()=>{
  document.getElementById('chars').textContent=rfText.value.length;
  // VienkÄrÅ¡s "synthetic" frÄÅ¾u detektors
  const badWords=['AI','GPT','ChatGPT','synthetic','robotic','neural'];
  const found=badWords.some(w=>rfText.value.includes(w));
  syntheticAlert.hidden=!found;
});

rfPost.addEventListener('click',async()=>{
  const txt=rfText.value.trim();
  if(!txt)return showSnack('Type something real!');
  let mediaUrl=null;
  const file=rfMedia.files[0];
  if(file){
    if(file.size>25*1024*1024)return showSnack('File too large (max 25MB)');
    const path=`uploads/${Date.now()}_${file.name}`;

    const {error}=await supabase.storage.from(file.type.startsWith('video')?'videos':'photos').upload(path,file);
    if(error)return showSnack('Upload failed');
    const {data}=supabase.storage.from(file.type.startsWith('video')?'videos':'photos').getPublicUrl(path);
    mediaUrl=data.publicUrl;
  }
  const user=(await supabase.auth.getUser()).data.user;
  await supabase.from('realflow_posts').insert([{user_id:user?.id||null,text:txt,media_url:mediaUrl}]);
  rfText.value='';
  rfMedia.value='';
});

async function loadFlow(){
  const {data}=await supabase.from('realflow_posts').select('*').order('created_at',{ascending:false}).limit(50);
  rfFeed.innerHTML='';
  data?.forEach(post=>{
    const div=document.createElement('div');
    div.className='card';
div.innerHTML=`
  <p style="margin-bottom:6px;"><strong>${post.text}</strong></p>
  ${post.media_url ? post.media_url.endsWith('.mp4')
    ? '<video controls style="max-width:100%;border-radius:10px"><source src="'+post.media_url+'"></video>'
    : '<img src="'+post.media_url+'" style="max-width:100%;border-radius:10px">'
    : ''}
  <div style="margin-top:6px;font-size:13px;color:#666;">â¤ï¸ â˜• ğŸŒ¿ ğŸ™Œ</div>`;
rfFeed.appendChild(div);
});

}
loadFlow();

// Realtime Flow updates
supabase.channel('realtime:flow')
  .on('postgres_changes',{event:'INSERT',schema:'public',table:'realflow_posts'},payload=>{
    loadFlow();
  }).subscribe();

// Valodu pÄrslÄ“gÅ¡ana
const STR={
  lv:{hero_title:'Real Flow â€” dalies ar Ä«sto.',hero_lead:'Viens Ä«sts teikums no tavas dienas. Bez botiem.',synthetic_alert:'âš ï¸ Å is skan pÄrÄk mÄkslÄ«gi.',say_btn:'PublicÄ“t'},
  en:{hero_title:'Real Flow â€” share whatâ€™s real.',hero_lead:'One short, honest thought from your day. No bots.',synthetic_alert:'âš ï¸ This sounds synthetic.',say_btn:'Say it'}
};
document.getElementById('lang-lv').addEventListener('click',()=>setLang('lv'));
document.getElementById('lang-en').addEventListener('click',()=>setLang('en'));
function setLang(l){
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const key=el.getAttribute('data-i18n');
    el.textContent=STR[l][key];
  });
  document.querySelectorAll('[data-i18n-ph]').forEach(el=>{
    const key=el.getAttribute('data-i18n-ph');
    el.placeholder=STR[l][key];
  });
  showSnack(l==='lv'?'Valoda: latvieÅ¡u':'Language: English');
}
</script>

<footer>
  <div>LegitSpace 6.6 Â· Mars Edition ğŸš€</div>
</footer>

</main>
</body>
</html>
